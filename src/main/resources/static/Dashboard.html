<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin-top: 100px; }
        h1 { color: #333; }
        .logout-btn { padding: 10px 20px; background-color: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer; text-decoration: none; margin-top: 20px;}
        .logout-btn:hover { background-color: #c82333; }
    </style>
</head>
<body>

<h1 id="welcomeMessage">Loading your dashboard...</h1>
<p>You have successfully logged in using a secure JWT.</p>

<button id="logoutBtn" class="logout-btn">Log Out</button>

<script>
    const token = localStorage.getItem('jwtToken');

    if (!token) {
        window.location.href = '/index.html';
    } else {
        // WE HAVE A TOKEN! Let's ask the server for our name.
        fetch('/api/auth/me', {
            method: 'GET',
            headers: {
                // This is the industry standard way to send a token!
                'Authorization': 'Bearer ' + token
            }
        })
        .then(async response => {
            if (response.ok) {
                const userData = await response.json();
                // Update the HTML with the user's actual name!
                document.getElementById('welcomeMessage').innerText = 'Welcome back, ' + userData.fullName + '! ðŸŽ‰';
            } else {
                // If the server rejects the token (e.g., it expired), kick them out
                localStorage.removeItem('jwtToken');
                window.location.href = '/index.html';
            }
        })
        .catch(error => {
            console.error("Error fetching user data:", error);
        });
    }

    // The Logout Button
    document.getElementById('logoutBtn').addEventListener('click', function() {
        localStorage.removeItem('jwtToken');
        window.location.href = '/index.html';
    });
</script>

</body>
</html>